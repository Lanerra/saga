2025-05-22 10:02:45 - INFO - [root:32] - File logging enabled. Log file: novel_output/saga_run.log
2025-05-22 10:02:45 - INFO - [root:37] - Logging setup complete. Level: INFO
2025-05-22 10:02:45 - INFO - [__main__:131] - --- Starting Saga Novel Generation (Execution Mode: Async, Neo4j Decomposed) ---
2025-05-22 10:02:45 - INFO - [state_manager:40] - Successfully connected to Neo4j at bolt://localhost:7687
2025-05-22 10:02:45 - INFO - [state_manager:98] - Creating/verifying Neo4j indexes and constraints...
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT novelInfo_id_unique IF NOT EXISTS FOR (e:NovelInfo) REQUIRE (e.id) IS UNIQUE` has no effect.} {description: `CONSTRAINT constraint_388d9938 FOR (e:NovelInfo) REQUIRE (e.id) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT novelInfo_id_unique IF NOT EXISTS FOR (n:NovelInfo) REQUIRE n.id IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT chapter_number_unique IF NOT EXISTS FOR (e:Chapter) REQUIRE (e.number) IS UNIQUE` has no effect.} {description: `CONSTRAINT constraint_3b7ce0f3 FOR (e:Chapter) REQUIRE (e.number) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT chapter_number_unique IF NOT EXISTS FOR (c:Chapter) REQUIRE c.number IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT entity_name_unique IF NOT EXISTS FOR (e:Entity) REQUIRE (e.name) IS UNIQUE` has no effect.} {description: `CONSTRAINT constraint_5adcbbfe FOR (e:Entity) REQUIRE (e.name) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT entity_name_unique IF NOT EXISTS FOR (e:Entity) REQUIRE e.name IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT character_name_unique IF NOT EXISTS FOR (e:Character) REQUIRE (e.name) IS UNIQUE` has no effect.} {description: `CONSTRAINT constraint_2f4f04ef FOR (e:Character) REQUIRE (e.name) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT character_name_unique IF NOT EXISTS FOR (char:Character) REQUIRE char.name IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT worldElement_id_unique IF NOT EXISTS FOR (e:WorldElement) REQUIRE (e.id) IS UNIQUE` has no effect.} {description: `CONSTRAINT constraint_c7b8eec8 FOR (e:WorldElement) REQUIRE (e.id) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT worldElement_id_unique IF NOT EXISTS FOR (we:WorldElement) REQUIRE we.id IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT worldContainer_id_unique IF NOT EXISTS FOR (e:WorldContainer) REQUIRE (e.id) IS UNIQUE` has no effect.} {description: `CONSTRAINT constraint_308c80de FOR (e:WorldContainer) REQUIRE (e.id) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT worldContainer_id_unique IF NOT EXISTS FOR (wc:WorldContainer) REQUIRE wc.id IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT trait_name_unique IF NOT EXISTS FOR (e:Trait) REQUIRE (e.name) IS UNIQUE` has no effect.} {description: `CONSTRAINT constraint_73efdf82 FOR (e:Trait) REQUIRE (e.name) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT trait_name_unique IF NOT EXISTS FOR (t:Trait) REQUIRE t.name IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT plotPoint_id_unique IF NOT EXISTS FOR (e:PlotPoint) REQUIRE (e.id) IS UNIQUE` has no effect.} {description: `CONSTRAINT constraint_30ed8a5 FOR (e:PlotPoint) REQUIRE (e.id) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT plotPoint_id_unique IF NOT EXISTS FOR (pp:PlotPoint) REQUIRE pp.id IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE CONSTRAINT valueNode_value_type_unique IF NOT EXISTS FOR (e:ValueNode) REQUIRE (e.value, e.type) IS UNIQUE` has no effect.} {description: `CONSTRAINT valueNode_value_type_unique FOR (e:ValueNode) REQUIRE (e.value, e.type) IS UNIQUE` already exists.} {position: None} for query: 'CREATE CONSTRAINT valueNode_value_type_unique IF NOT EXISTS FOR (vn:ValueNode) REQUIRE (vn.value, vn.type) IS UNIQUE'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX plotPoint_sequence IF NOT EXISTS FOR (e:PlotPoint) ON (e.sequence)` has no effect.} {description: `RANGE INDEX index_3962cb06 FOR (e:PlotPoint) ON (e.sequence)` already exists.} {position: None} for query: 'CREATE INDEX plotPoint_sequence IF NOT EXISTS FOR (pp:PlotPoint) ON (pp.sequence)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX statusEvent_chapter_updated IF NOT EXISTS FOR (e:StatusEvent) ON (e.chapter_updated)` has no effect.} {description: `RANGE INDEX index_950ece8a FOR (e:StatusEvent) ON (e.chapter_updated)` already exists.} {position: None} for query: 'CREATE INDEX statusEvent_chapter_updated IF NOT EXISTS FOR (s:StatusEvent) ON (s.chapter_updated)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX developmentEvent_chapter_updated IF NOT EXISTS FOR (e:DevelopmentEvent) ON (e.chapter_updated)` has no effect.} {description: `RANGE INDEX index_e1a98a8e FOR (e:DevelopmentEvent) ON (e.chapter_updated)` already exists.} {position: None} for query: 'CREATE INDEX developmentEvent_chapter_updated IF NOT EXISTS FOR (d:DevelopmentEvent) ON (d.chapter_updated)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX worldElaborationEvent_chapter_updated IF NOT EXISTS FOR (e:WorldElaborationEvent) ON (e.chapter_updated)` has no effect.} {description: `RANGE INDEX index_a8fd279 FOR (e:WorldElaborationEvent) ON (e.chapter_updated)` already exists.} {position: None} for query: 'CREATE INDEX worldElaborationEvent_chapter_updated IF NOT EXISTS FOR (we:WorldElaborationEvent) ON (we.chapter_updated)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX dynamicRel_chapter_added IF NOT EXISTS FOR ()-[e:DYNAMIC_REL]-() ON (e.chapter_added)` has no effect.} {description: `RANGE INDEX index_308c2baa FOR ()-[e:DYNAMIC_REL]-() ON (e.chapter_added)` already exists.} {position: None} for query: 'CREATE INDEX dynamicRel_chapter_added IF NOT EXISTS FOR ()-[r:DYNAMIC_REL]-() ON (r.chapter_added)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX dynamicRel_type IF NOT EXISTS FOR ()-[e:DYNAMIC_REL]-() ON (e.type)` has no effect.} {description: `RANGE INDEX index_90849398 FOR ()-[e:DYNAMIC_REL]-() ON (e.type)` already exists.} {position: None} for query: 'CREATE INDEX dynamicRel_type IF NOT EXISTS FOR ()-[r:DYNAMIC_REL]-() ON (r.type)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX worldElement_category IF NOT EXISTS FOR (e:WorldElement) ON (e.category)` has no effect.} {description: `RANGE INDEX index_c46fc864 FOR (e:WorldElement) ON (e.category)` already exists.} {position: None} for query: 'CREATE INDEX worldElement_category IF NOT EXISTS FOR (we:WorldElement) ON (we.category)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX worldElement_name IF NOT EXISTS FOR (e:WorldElement) ON (e.name)` has no effect.} {description: `RANGE INDEX index_3dd109cb FOR (e:WorldElement) ON (e.name)` already exists.} {position: None} for query: 'CREATE INDEX worldElement_name IF NOT EXISTS FOR (we:WorldElement) ON (we.name)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX chapter_is_provisional IF NOT EXISTS FOR (e:Chapter) ON (e.is_provisional)` has no effect.} {description: `RANGE INDEX chapter_is_provisional FOR (e:Chapter) ON (e.is_provisional)` already exists.} {position: None} for query: 'CREATE INDEX chapter_is_provisional IF NOT EXISTS FOR (c:Chapter) ON (c.is_provisional)'
2025-05-22 10:02:45 - INFO - [neo4j.notifications:337] - Received notification from DBMS server: {severity: INFORMATION} {code: Neo.ClientNotification.Schema.IndexOrConstraintAlreadyExists} {category: SCHEMA} {title: `CREATE RANGE INDEX dynamicRel_is_provisional IF NOT EXISTS FOR ()-[e:DYNAMIC_REL]-() ON (e.is_provisional)` has no effect.} {description: `RANGE INDEX dynamicRel_is_provisional FOR ()-[e:DYNAMIC_REL]-() ON (e.is_provisional)` already exists.} {position: None} for query: 'CREATE INDEX dynamicRel_is_provisional IF NOT EXISTS FOR ()-[r:DYNAMIC_REL]-() ON (r.is_provisional)'
2025-05-22 10:02:45 - INFO - [state_manager:132] - Neo4j indexes and constraints verification process complete.
2025-05-22 10:02:45 - INFO - [__main__:136] - state_manager initialized and Neo4j connection/schema verified.
2025-05-22 10:02:45 - INFO - [novel_agent:30] - Initializing NovelWriterAgent instance...
2025-05-22 10:02:45 - INFO - [novel_agent:35] - NovelWriterAgent instance created. Call async_init() to load/prepare state.
2025-05-22 10:02:45 - INFO - [novel_agent:38] - NovelWriterAgent async_init started...
2025-05-22 10:02:45 - INFO - [state_manager:612] - Neo4j loaded chapter count: 0
2025-05-22 10:02:45 - INFO - [novel_agent:41] - Loaded chapter count from Neo4j: 0
2025-05-22 10:02:45 - INFO - [state_manager:218] - Loading decomposed plot outline from Neo4j...
2025-05-22 10:02:45 - INFO - [state_manager:353] - Loading decomposed character profiles from Neo4j...
2025-05-22 10:02:45 - INFO - [state_manager:538] - Loading decomposed world building data from Neo4j...
2025-05-22 10:02:45 - WARNING - [state_manager:225] - No NovelInfo node found with id 'saga_main_novel_info'. Returning empty plot outline.
2025-05-22 10:02:45 - WARNING - [novel_agent:63] - Plot outline is empty after Neo4j load. Expected during initial setup or if save failed previously.
2025-05-22 10:02:45 - WARNING - [novel_agent:65] - Character profiles are empty after Neo4j load. Expected during initial setup or if save failed previously.
2025-05-22 10:02:45 - INFO - [novel_agent:69] - NovelWriterAgent async_init complete.
2025-05-22 10:02:45 - INFO - [__main__:140] - NovelWriterAgent initialized and state loaded (Python dicts from Neo4j).
2025-05-22 10:02:45 - INFO - [__main__:42] - Performing initial setup (populating agent's Python dicts)...
2025-05-22 10:02:45 - INFO - [initial_setup_logic:267] - Generating plot outline Python dict. Unhinged mode: False
2025-05-22 10:02:45 - INFO - [initial_setup_logic:275] - No valid user-supplied file. Proceeding with LLM/default generation for Python dicts.
2025-05-22 10:02:45 - INFO - [initial_setup_logic:364] - Calling LLM for plot outline generation (to plain text)...
2025-05-22 10:02:45 - WARNING - [llm_interface:66] - No direct tiktoken encoding found for model 'Qwen3-8B'. Attempting default encoding 'cl100k_base'.
2025-05-22 10:02:45 - INFO - [llm_interface:73] - Using default tiktoken encoding 'cl100k_base' for model 'Qwen3-8B' and cached.
2025-05-22 10:02:51 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:03:02 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-8B') Usage - Prompt: 520 tk, Comp: 503 tk, Total: 1023 tk
2025-05-22 10:03:02 - INFO - [initial_setup_logic:407] - Successfully generated plot outline dict: 'The Price of Eternity'
2025-05-22 10:03:02 - INFO - [initial_setup_logic:432] - Created initial profile for protagonist 'Sága' in agent.character_profiles.
2025-05-22 10:03:02 - INFO - [initial_setup_logic:715] - Generating initial world-building data (to plain text) via LLM...
2025-05-22 10:03:02 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:03:27 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-8B') Usage - Prompt: 899 tk, Comp: 1117 tk, Total: 2016 tk
2025-05-22 10:03:27 - INFO - [initial_setup_logic:745] - Successfully generated initial world-building dict via LLM (from plain text).
2025-05-22 10:03:27 - INFO - [novel_agent:72] - Saving agent state (plot, characters, world) to Neo4j (decomposed)...
2025-05-22 10:03:27 - INFO - [state_manager:155] - Saving decomposed plot outline to Neo4j using MERGE...
2025-05-22 10:03:27 - INFO - [state_manager:245] - Saving decomposed character profiles to Neo4j using MERGE...
2025-05-22 10:03:27 - INFO - [state_manager:414] - Saving decomposed world building data to Neo4j using MERGE...
2025-05-22 10:03:27 - INFO - [state_manager:89] - Successfully executed batch of 4 Cypher statements.
2025-05-22 10:03:27 - INFO - [state_manager:346] - Successfully saved decomposed character profiles to Neo4j using MERGE.
2025-05-22 10:03:27 - INFO - [state_manager:89] - Successfully executed batch of 16 Cypher statements.
2025-05-22 10:03:27 - INFO - [state_manager:211] - Successfully saved decomposed plot outline to Neo4j using MERGE.
2025-05-22 10:03:27 - INFO - [state_manager:89] - Successfully executed batch of 53 Cypher statements.
2025-05-22 10:03:27 - INFO - [state_manager:529] - Successfully saved decomposed world building data to Neo4j using MERGE.
2025-05-22 10:03:27 - INFO - [novel_agent:88] - Successfully saved plot_outline to Neo4j (decomposed).
2025-05-22 10:03:27 - INFO - [novel_agent:88] - Successfully saved character_profiles to Neo4j (decomposed).
2025-05-22 10:03:27 - INFO - [novel_agent:88] - Successfully saved world_building to Neo4j (decomposed).
2025-05-22 10:03:27 - INFO - [novel_agent:93] - All (3) state objects saved to Neo4j (decomposed) successfully.
2025-05-22 10:03:27 - INFO - [__main__:112] - Found existing NovelInfo node with plot points. Assuming KG already pre-populated or managed. Skipping explicit pre-population step.
2025-05-22 10:03:27 - INFO - [novel_agent:135] - === Starting Chapter 1 Generation ===
2025-05-22 10:03:27 - INFO - [chapter_planning_logic:163] - Planning Chapter 1 with detailed scenes...
2025-05-22 10:03:27 - INFO - [chapter_planning_logic:249] - Calling LLM (Qwen3-14B) for detailed scene plan for chapter 1 (target scenes: 10-18)...
2025-05-22 10:03:27 - WARNING - [llm_interface:66] - No direct tiktoken encoding found for model 'Qwen3-14B'. Attempting default encoding 'cl100k_base'.
2025-05-22 10:03:27 - INFO - [llm_interface:73] - Using default tiktoken encoding 'cl100k_base' for model 'Qwen3-14B' and cached.
2025-05-22 10:03:33 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:05:43 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-14B') Usage - Prompt: 862 tk, Comp: 3434 tk, Total: 4296 tk
2025-05-22 10:05:43 - INFO - [chapter_planning_logic:294] - Generated valid detailed scene plan for chapter 1 with 18 scenes from plain text.
2025-05-22 10:05:43 - INFO - [context_generation_logic:173] - Generating HYBRID context for Chapter 1...
2025-05-22 10:05:43 - INFO - [context_generation_logic:227] - Generated HYBRID context for Chapter 1, Tokens (est.): 137.
2025-05-22 10:05:43 - INFO - [chapter_drafting_logic:83] - Using detailed scene plan (plain text) for Ch 1 draft generation.
2025-05-22 10:05:43 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 0.
2025-05-22 10:05:43 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 0.
2025-05-22 10:05:43 - INFO - [chapter_drafting_logic:133] - Calling LLM (Qwen3-14B) for Ch 1 draft. Target minimum length: 15000 chars.
2025-05-22 10:05:45 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:08:36 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-14B') Usage - Prompt: 5300 tk, Comp: 3755 tk, Total: 9055 tk
2025-05-22 10:08:36 - INFO - [chapter_drafting_logic:158] - Generated initial draft for ch 1 (Length: 16844 chars).
2025-05-22 10:08:36 - INFO - [chapter_evaluation_logic:281] - Evaluating chapter 1 draft (length: 16844 chars)...
2025-05-22 10:08:36 - INFO - [chapter_evaluation_logic:330] - Skipping coherence check for Chapter 1.
2025-05-22 10:08:38 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:11434/api/embeddings "HTTP/1.1 200 OK"
2025-05-22 10:08:38 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 0.
2025-05-22 10:08:38 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 0.
2025-05-22 10:08:38 - INFO - [chapter_evaluation_logic:196] - Calling LLM (Qwen3-14B) for comprehensive (plain text) evaluation of chapter 1...
2025-05-22 10:09:23 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:09:23 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-14B') Usage - Prompt: 6167 tk, Comp: 836 tk, Total: 7003 tk
2025-05-22 10:09:23 - INFO - [chapter_evaluation_logic:266] - Comprehensive (plain text) evaluation for Ch 1 complete. LLM output: 'ISSUE CATEGORY: consistency
PROBLEM DESCRIPTION: The chapter introduces a new character (the client) who possesses a memory of Sága that she had "unknowingly surrendered years ago," but there is no pr...'
2025-05-22 10:09:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'thematic_alignment' in block 3 for Ch 1. Defaulting to 'meta'. Block: ISSUE CATEGORY: thematic_alignment
PROBLEM DESCRIPTION: The theme of "the cost of power" is present 
2025-05-22 10:09:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 4 for Ch 1. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter lacks sufficient descrip
2025-05-22 10:09:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 5 for Ch 1. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The setting descriptions, while pres
2025-05-22 10:09:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“It’s not just any memory,” the client said, their...'. This may fail patching. Problem: The chapter introduces a new character (the client) who possesses a memory of Sága that she had "unknowingly surrendered years ago," but there is no prior context or established lore about how individuals can possess or access someone else's memories outside the formal Memory Exchange system. This creates a plot inconsistency with the world-building rules, which state that memories are stored in crystalline nodes and cataloged for retrieval or disposal by the Council and Memory Keepers.
2025-05-22 10:09:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“I think it’s the key to something bigger than me....'. This may fail patching. Problem: While the chapter introduces the discovery of a hidden childhood memory, it does not fully establish how this memory was surrendered or why it was hidden. The plot point is triggered by the client’s possession of Sága’s memory, but the mechanism of how she "unknowingly surrendered" it is only hinted at, rather than clearly explained. This weakens the impact of the intended plot point and leaves the reader with unresolved questions about the nature of her lost past.
2025-05-22 10:09:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“She had spent years trading away pieces of her pa...'. This may fail patching. Problem: The theme of "the cost of power" is present but not deeply explored in this chapter. While Sága begins to question the system that has shaped her life, there is minimal introspection or reflection on how the memory trade represents a broader power dynamic in Virellis. The emotional weight of the theme is underdeveloped, especially in relation to her internal transformation.
2025-05-22 10:09:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“She felt something stir inside her—a connection, ...'. This may fail patching. Problem: The chapter lacks sufficient descriptive depth in key scenes, particularly in the memory extraction sequence and the emotional impact of discovering her childhood. Additionally, character introspection is limited, and the pacing moves quickly from discovery to action without fully immersing the reader in Sága’s internal struggle or the world around her. The overall length falls short of the target (15,000 characters), which may affect the immersive quality of the narrative.
2025-05-22 10:09:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“The air was thick with the scent of ozone and som...'. This may fail patching. Problem: The setting descriptions, while present, are not sufficiently detailed or immersive to fully convey the oppressive atmosphere of Virellis or the haunting nature of the Veil. This reduces the reader’s ability to feel the weight of the dystopian horror genre and limits the emotional resonance of Sága’s discoveries.
2025-05-22 10:09:23 - INFO - [chapter_evaluation_logic:390] - Evaluation for Ch 1 complete. Needs revision: True. Summary reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.. Detailed problems: 5
2025-05-22 10:09:23 - WARNING - [novel_agent:173] - Ch 1 initial draft (16844 chars) flagged for revision. Reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.
2025-05-22 10:09:23 - WARNING - [chapter_revision_logic:262] - Attempting revision for chapter 1. Reason(s) summary:
- Consistency issues identified by LLM.
- Meta/Uncategorized issues identified by LLM.
- Plot Arc deviation identified by LLM.
2025-05-22 10:09:23 - INFO - [chapter_revision_logic:270] - Patch-based revision enabled. Attempting to generate and apply patches for Ch 1 (5 actionable problems identified).
2025-05-22 10:09:23 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '“It’s not just any memory,” the client said, their...' Returning full text snippet as fallback.
2025-05-22 10:09:23 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '“I think it’s the key to something bigger than me....' Returning full text snippet as fallback.
2025-05-22 10:09:23 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '“She had spent years trading away pieces of her pa...' Returning full text snippet as fallback.
2025-05-22 10:09:23 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '“She felt something stir inside her—a connection, ...' Returning full text snippet as fallback.
2025-05-22 10:09:23 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '“The air was thick with the scent of ozone and som...' Returning full text snippet as fallback.
2025-05-22 10:09:23 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 1. Problem: The chapter introduces a new character (the client) who poss... Quote: “It’s not just any memory,” the client said, their voice hoa...
2025-05-22 10:09:23 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 1. Problem: While the chapter introduces the discovery of a hidden child... Quote: “I think it’s the key to something bigger than me.”...
2025-05-22 10:09:23 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 1. Problem: The theme of "the cost of power" is present but not deeply e... Quote: “She had spent years trading away pieces of her past, convin...
2025-05-22 10:09:23 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 1. Problem: The chapter lacks sufficient descriptive depth in key scenes... Quote: “She felt something stir inside her—a connection, a recognit...
2025-05-22 10:09:23 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 1. Problem: The setting descriptions, while present, are not sufficientl... Quote: “The air was thick with the scent of ozone and something met...
2025-05-22 10:09:41 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:09:41 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5859 tk, Comp: 318 tk, Total: 6177 tk
2025-05-22 10:09:49 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:09:49 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5872 tk, Comp: 579 tk, Total: 6451 tk
2025-05-22 10:09:57 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:09:57 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5861 tk, Comp: 525 tk, Total: 6386 tk
2025-05-22 10:09:59 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:09:59 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5864 tk, Comp: 307 tk, Total: 6171 tk
2025-05-22 10:10:07 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:10:07 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5909 tk, Comp: 336 tk, Total: 6245 tk
2025-05-22 10:10:07 - INFO - [chapter_revision_logic:185] - Generated 5 patch instructions for Ch 1.
2025-05-22 10:10:07 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '“It’s not just any memory,” the client said, their voice hoarse with something she couldn’t quite pl...'
2025-05-22 10:10:07 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '“I think it’s the key to something bigger than me.”...'
2025-05-22 10:10:07 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '“She had spent years trading away pieces of her past, convincing herself that survival was worth it....'
2025-05-22 10:10:07 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '“She felt something stir inside her—a connection, a recognition she couldn’t quite name.”...'
2025-05-22 10:10:07 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '“The air was thick with the scent of ozone and something metallic—like the city itself was exhaling ...'
2025-05-22 10:10:07 - WARNING - [chapter_revision_logic:221] - 5/5 applicable patches could not be applied because their search_text was not found in the original chapter.
2025-05-22 10:10:07 - INFO - [chapter_revision_logic:279] - Successfully applied 5 patches to Ch 1. Original len: 16844, Patched len: 16844.
2025-05-22 10:10:07 - INFO - [chapter_revision_logic:296] - Patched text similarity score with original draft: 1.0000
2025-05-22 10:10:07 - WARNING - [chapter_revision_logic:298] - Patched text for ch 1 is too similar to original (Score: 1.0000 >= Threshold: 0.985). Patches may have been ineffective.
2025-05-22 10:10:07 - INFO - [chapter_revision_logic:421] - Revision process for ch 1 produced a candidate text (Length: 16844 chars).
2025-05-22 10:10:07 - INFO - [novel_agent:186] - Revision attempted for ch 1. Re-evaluating revised draft (16844 chars)...
2025-05-22 10:10:07 - INFO - [chapter_evaluation_logic:281] - Evaluating chapter 1 draft (length: 16844 chars)...
2025-05-22 10:10:07 - INFO - [chapter_evaluation_logic:330] - Skipping coherence check for Chapter 1.
2025-05-22 10:10:07 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 0.
2025-05-22 10:10:07 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 0.
2025-05-22 10:10:07 - INFO - [chapter_evaluation_logic:196] - Calling LLM (Qwen3-14B) for comprehensive (plain text) evaluation of chapter 1...
2025-05-22 10:10:42 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:10:42 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-14B') Usage - Prompt: 6167 tk, Comp: 650 tk, Total: 6817 tk
2025-05-22 10:10:42 - INFO - [chapter_evaluation_logic:266] - Comprehensive (plain text) evaluation for Ch 1 complete. LLM output: 'ISSUE CATEGORY: consistency
PROBLEM DESCRIPTION: The client's knowledge of Sága's forgotten memory is not sufficiently explained, creating a plot inconsistency. How did they know about a memory she ha...'
2025-05-22 10:10:42 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'thematic_alignment' in block 3 for Ch 1. Defaulting to 'meta'. Block: ISSUE CATEGORY: thematic_alignment
PROBLEM DESCRIPTION: The theme of "the cost of power" is present 
2025-05-22 10:10:42 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 4 for Ch 1. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter lacks sufficient descrip
2025-05-22 10:10:42 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 5 for Ch 1. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter is under the target leng
2025-05-22 10:10:42 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“It’s not just any memory,” the client said, their...'. This may fail patching. Problem: The client's knowledge of Sága's forgotten memory is not sufficiently explained, creating a plot inconsistency. How did they know about a memory she had surrendered and forgotten?
2025-05-22 10:10:42 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“She had spent years surviving on the trade, convi...'. This may fail patching. Problem: The chapter introduces the discovery of Sága’s hidden memory but does not fully establish how this revelation directly advances her arc toward reclaiming her past. It sets up intrigue but lacks a clear turning point in her character development.
2025-05-22 10:10:42 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“She had spent years trading away pieces of her pa...'. This may fail patching. Problem: The theme of "the cost of power" is present but not deeply explored in relation to Sága’s personal discovery. The emotional weight of her loss and the moral implications are underdeveloped.
2025-05-22 10:10:42 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“She read the words over and over, her mind strugg...'. This may fail patching. Problem: The chapter lacks sufficient descriptive depth and introspection to fully immerse the reader in Sága's emotional journey. Key moments are underdeveloped, especially the memory extraction and the discovery of the file.
2025-05-22 10:10:42 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 1 NOT FOUND VERBATIM in chapter text: '“She had always believed her childhood was lost in...'. This may fail patching. Problem: The chapter is under the target length of at least 15000 characters. While it covers important plot points, it could be expanded with additional scenes or introspection to meet the required depth.
2025-05-22 10:10:42 - INFO - [chapter_evaluation_logic:390] - Evaluation for Ch 1 complete. Needs revision: True. Summary reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.. Detailed problems: 5
2025-05-22 10:10:42 - ERROR - [novel_agent:191] - Revised draft for ch 1 STILL FAILED evaluation. Reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.
2025-05-22 10:10:42 - WARNING - [novel_agent:194] - Reverting to original draft (16844 chars) as revised draft (16844 chars) also failed evaluation and original is longer/better.
2025-05-22 10:10:42 - INFO - [novel_agent:232] - Finalizing chapter 1 (From flawed draft: True). Text length: 16844.
2025-05-22 10:10:42 - WARNING - [llm_interface:66] - No direct tiktoken encoding found for model 'Qwen3-4B'. Attempting default encoding 'cl100k_base'.
2025-05-22 10:10:42 - INFO - [llm_interface:73] - Using default tiktoken encoding 'cl100k_base' for model 'Qwen3-4B' and cached.
2025-05-22 10:10:49 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:10:49 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-4B') Usage - Prompt: 3842 tk, Comp: 86 tk, Total: 3928 tk
2025-05-22 10:10:49 - INFO - [knowledge_management_logic:60] - Generated summary for ch 1: 'Sága discovers a memory orb that belongs to her, revealing she was a test subject in a Council exper...'
2025-05-22 10:10:49 - INFO - [state_manager:650] - Neo4j: Successfully saved chapter data (including embedding) for chapter 1.
2025-05-22 10:10:49 - INFO - [novel_agent:259] - Saved chapter text and raw LLM log files for ch 1.
2025-05-22 10:10:49 - INFO - [novel_agent:263] - Core finalization complete for ch 1.
2025-05-22 10:10:49 - INFO - [knowledge_management_logic:912] - Updating all knowledge bases for ch 1 (Source from flawed draft: True)...
2025-05-22 10:10:49 - INFO - [knowledge_management_logic:586] - Performing unified knowledge extraction (plain text) for Chapter 1...
2025-05-22 10:10:49 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 0.
2025-05-22 10:10:49 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 0.
2025-05-22 10:10:49 - INFO - [knowledge_management_logic:705] - Calling LLM (Qwen3-8B) for unified knowledge extraction (Ch 1).
2025-05-22 10:10:56 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:11:22 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-8B') Usage - Prompt: 6420 tk, Comp: 1098 tk, Total: 7518 tk
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:741] - Unified knowledge extraction (plain text parsing) for Ch 1 complete. Char updates: 3, World updates categories: 3, KG Triples: 31.
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:168] - Merging character profile updates for ch 1. Characters in update: ['Sága', 'Lir', 'The Client']
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Sága'. New traits: ['Curious', 'Haunted']
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:136] - Prepared new character profile for 'Lir'.
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Lir'. New traits: ['Concerned', 'Loyal', 'Observant']
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:136] - Prepared new character profile for 'The Client'.
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'The Client'. New traits: ['Determined', 'Enigmatic', 'Possibly an Echoist']
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:199] - Character profile Python dict merge complete for ch 1. Updated: 1, New: 2.
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:276] - Merging world-building updates for ch 1. Categories in update: ['locations', 'systems', 'lore']
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:114] - Applied modification to 'description' for 'systems.The Memory Trade'. New value: 'A mandatory system where citizens exchange their most precious memorie...'
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:114] - Applied modification to 'description' for 'lore.The Price of Eternity'. New value: 'A belief system that holds that memories are the soul's currency. By s...'
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:320] - World-building Python dict merge complete for ch 1. Approx 3 items affected/added.
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, discovered, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Subject, Predicate, Object). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, has_feature, Child's drawing). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, works_for, Sága). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, interacted_with, Lir). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, interacted_with, The Client). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, decided_to, Reclaim her past). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, Concerned). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Client, is_a, Echoist). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, status_is, Unsettled, seeking truth). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, thought_about, Her childhood). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Determined). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, feels, Haunted). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Curious). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, lost, Her childhood memory). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, located_in, Old district of Virellis). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Trade, caused_by, The Council of Eternity). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Council of Eternity, has_goal, Maintain control over the city's population). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Council of Eternity, has_goal, Ensure the stability of the memory trade). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Determined). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Exchange, located_in, Virellis). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, thought_about, The Council's experiments). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Client, member_of, The Echoists). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Trade, has_history_event, Memory extraction incident involving Sága). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, travelled_to, The Memory Exchange). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Exchange, has_atmosphere, Cold, sterile, claustrophobic). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Haunted). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Curious). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Client, said, "You were never meant to forget. The Council took that from you, but it wasn’t the only one. There are others like you. Others who remember."). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Council of Eternity, has_goal, Enforce the new law without resistance). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, acquired, A memory orb from The Client). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:950] - KG update from unified_extraction for ch 1: Added 31 triples, skipped 0.
2025-05-22 10:11:22 - INFO - [knowledge_management_logic:953] - Unified knowledge extraction processing complete for ch 1. In-memory dicts updated, KG triples sent to Neo4j.
2025-05-22 10:11:22 - INFO - [novel_agent:72] - Saving agent state (plot, characters, world) to Neo4j (decomposed)...
2025-05-22 10:11:22 - INFO - [state_manager:155] - Saving decomposed plot outline to Neo4j using MERGE...
2025-05-22 10:11:22 - INFO - [state_manager:245] - Saving decomposed character profiles to Neo4j using MERGE...
2025-05-22 10:11:22 - INFO - [state_manager:414] - Saving decomposed world building data to Neo4j using MERGE...
2025-05-22 10:11:22 - INFO - [state_manager:89] - Successfully executed batch of 19 Cypher statements.
2025-05-22 10:11:22 - INFO - [state_manager:346] - Successfully saved decomposed character profiles to Neo4j using MERGE.
2025-05-22 10:11:22 - INFO - [state_manager:89] - Successfully executed batch of 16 Cypher statements.
2025-05-22 10:11:22 - INFO - [state_manager:211] - Successfully saved decomposed plot outline to Neo4j using MERGE.
2025-05-22 10:11:22 - INFO - [state_manager:89] - Successfully executed batch of 58 Cypher statements.
2025-05-22 10:11:22 - INFO - [state_manager:529] - Successfully saved decomposed world building data to Neo4j using MERGE.
2025-05-22 10:11:22 - INFO - [novel_agent:88] - Successfully saved plot_outline to Neo4j (decomposed).
2025-05-22 10:11:22 - INFO - [novel_agent:88] - Successfully saved character_profiles to Neo4j (decomposed).
2025-05-22 10:11:22 - INFO - [novel_agent:88] - Successfully saved world_building to Neo4j (decomposed).
2025-05-22 10:11:22 - INFO - [novel_agent:93] - All (3) state objects saved to Neo4j (decomposed) successfully.
2025-05-22 10:11:22 - INFO - [novel_agent:228] - === Finished Ch 1 With Flaws (Marked as flawed due to evaluation or length issues) ===
2025-05-22 10:11:22 - INFO - [novel_agent:135] - === Starting Chapter 2 Generation ===
2025-05-22 10:11:22 - INFO - [chapter_planning_logic:163] - Planning Chapter 2 with detailed scenes...
2025-05-22 10:11:22 - INFO - [chapter_planning_logic:249] - Calling LLM (Qwen3-14B) for detailed scene plan for chapter 2 (target scenes: 10-18)...
2025-05-22 10:11:29 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:13:38 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-14B') Usage - Prompt: 1160 tk, Comp: 3376 tk, Total: 4536 tk
2025-05-22 10:13:38 - INFO - [chapter_planning_logic:294] - Generated valid detailed scene plan for chapter 2 with 18 scenes from plain text.
2025-05-22 10:13:38 - INFO - [context_generation_logic:173] - Generating HYBRID context for Chapter 2...
2025-05-22 10:13:38 - INFO - [context_generation_logic:33] - Semantic context query for ch 2 based on Plot Point 2: 'She begins secretly collecting forbidden memories, risking her life to uncover the truth about the c...'
2025-05-22 10:13:40 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:11434/api/embeddings "HTTP/1.1 200 OK"
2025-05-22 10:13:40 - INFO - [state_manager:712] - Neo4j: Retrieved 1 past embeddings for context before chapter 2.
2025-05-22 10:13:40 - INFO - [context_generation_logic:104] - Top 1 relevant chapters for SEMANTIC context (semantic search): [1] (Scores: ['0.571'])
2025-05-22 10:13:40 - INFO - [context_generation_logic:157] - Constructed final SEMANTIC context: 96 tokens from chapters [1].
2025-05-22 10:13:40 - INFO - [context_generation_logic:227] - Generated HYBRID context for Chapter 2, Tokens (est.): 249.
2025-05-22 10:13:40 - INFO - [chapter_drafting_logic:83] - Using detailed scene plan (plain text) for Ch 2 draft generation.
2025-05-22 10:13:40 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 1.
2025-05-22 10:13:40 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 1.
2025-05-22 10:13:40 - INFO - [chapter_drafting_logic:133] - Calling LLM (Qwen3-14B) for Ch 2 draft. Target minimum length: 15000 chars.
2025-05-22 10:13:43 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:16:24 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-14B') Usage - Prompt: 5966 tk, Comp: 3461 tk, Total: 9427 tk
2025-05-22 10:16:24 - INFO - [chapter_drafting_logic:158] - Generated initial draft for ch 2 (Length: 15483 chars).
2025-05-22 10:16:24 - INFO - [chapter_evaluation_logic:281] - Evaluating chapter 2 draft (length: 15483 chars)...
2025-05-22 10:16:24 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:11434/api/embeddings "HTTP/1.1 200 OK"
2025-05-22 10:16:24 - INFO - [chapter_evaluation_logic:316] - Coherence score with previous chapter (1): 0.7750
2025-05-22 10:16:24 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 1.
2025-05-22 10:16:24 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 1.
2025-05-22 10:16:24 - INFO - [chapter_evaluation_logic:196] - Calling LLM (Qwen3-14B) for comprehensive (plain text) evaluation of chapter 2...
2025-05-22 10:17:08 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:17:08 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-14B') Usage - Prompt: 6598 tk, Comp: 774 tk, Total: 7372 tk
2025-05-22 10:17:08 - INFO - [chapter_evaluation_logic:266] - Comprehensive (plain text) evaluation for Ch 2 complete. LLM output: 'ISSUE CATEGORY: consistency
PROBLEM DESCRIPTION: The chapter introduces a journal with entries about subjects being experimented on, but it contradicts the established fact that Lir is unaware of the ...'
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'thematic_alignment' in block 3 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: thematic_alignment
PROBLEM DESCRIPTION: The theme of "the cost of power" is not full
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 4 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter lacks sufficient introsp
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 5 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The dialogue between Sága and Lir is
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 6 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter is slightly under the ta
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"Lir looked up from the journal. 'Someone who knew...'. This may fail patching. Problem: The chapter introduces a journal with entries about subjects being experimented on, but it contradicts the established fact that Lir is unaware of the full extent of the Council's experiments. His sudden realization and willingness to help Sága suggests he may have known more than his profile indicates.
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"They left the workshop under the cover of night.....'. This may fail patching. Problem: While the chapter does show Sága collecting forbidden memories (the ones from The Schoolhouse), it doesn't clearly establish that she is doing so *secretly* or that she is *risking her life* in the process. The action feels more like a discovery than a deliberate act of rebellion.
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"The Memory Trade: A mandatory system where citize...'. This may fail patching. Problem: The theme of "the cost of power" is not fully developed in this chapter. While Sága begins to question the system, there is minimal exploration of how the memory trade represents a misuse of power or how it affects her moral compass.
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"She had always known she was different, that her ...'. This may fail patching. Problem: The chapter lacks sufficient introspection from Sága about her transformation from self-serving survivor to someone seeking truth. Her emotional journey is hinted at but not fully explored, and the setting descriptions could be more immersive.
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"Lir’s face paled. 'That’s not possible.'"...'. This may fail patching. Problem: The dialogue between Sága and Lir is effective but could be expanded with more tension and subtext, especially regarding Lir’s shift from concern to determination. This would add depth to their relationship and highlight the stakes of their actions.
2025-05-22 10:17:08 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"The air was thick with the scent of ozone and som...'. This may fail patching. Problem: The chapter is slightly under the target length of 15000 characters. While it covers important plot progression, it could be expanded with more sensory detail, extended dialogue, or additional introspection to fully immerse the reader in Sága’s emotional and physical journey.
2025-05-22 10:17:08 - INFO - [chapter_evaluation_logic:390] - Evaluation for Ch 2 complete. Needs revision: True. Summary reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.. Detailed problems: 6
2025-05-22 10:17:08 - WARNING - [novel_agent:173] - Ch 2 initial draft (15483 chars) flagged for revision. Reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.
2025-05-22 10:17:08 - WARNING - [chapter_revision_logic:262] - Attempting revision for chapter 2. Reason(s) summary:
- Consistency issues identified by LLM.
- Meta/Uncategorized issues identified by LLM.
- Plot Arc deviation identified by LLM.
2025-05-22 10:17:08 - INFO - [chapter_revision_logic:270] - Patch-based revision enabled. Attempting to generate and apply patches for Ch 2 (6 actionable problems identified).
2025-05-22 10:17:08 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"Lir looked up from the journal. 'Someone who knew...' Returning full text snippet as fallback.
2025-05-22 10:17:08 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"They left the workshop under the cover of night.....' Returning full text snippet as fallback.
2025-05-22 10:17:08 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"The Memory Trade: A mandatory system where citize...' Returning full text snippet as fallback.
2025-05-22 10:17:08 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"She had always known she was different, that her ...' Returning full text snippet as fallback.
2025-05-22 10:17:08 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"Lir’s face paled. 'That’s not possible.'"...' Returning full text snippet as fallback.
2025-05-22 10:17:08 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"The air was thick with the scent of ozone and som...' Returning full text snippet as fallback.
2025-05-22 10:17:08 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 2. Problem: The chapter introduces a journal with entries about subjects... Quote: "Lir looked up from the journal. 'Someone who knew what the ...
2025-05-22 10:17:08 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 2. Problem: While the chapter does show Sága collecting forbidden memori... Quote: "They left the workshop under the cover of night..."...
2025-05-22 10:17:08 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 2. Problem: The theme of "the cost of power" is not fully developed in t... Quote: "The Memory Trade: A mandatory system where citizens exchang...
2025-05-22 10:17:08 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 2. Problem: The chapter lacks sufficient introspection from Sága about h... Quote: "She had always known she was different, that her memories w...
2025-05-22 10:17:08 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 2. Problem: The dialogue between Sága and Lir is effective but could be ... Quote: "Lir’s face paled. 'That’s not possible.'"...
2025-05-22 10:17:08 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 2. Problem: The chapter is slightly under the target length of 15000 cha... Quote: "The air was thick with the scent of ozone and something met...
2025-05-22 10:17:28 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:17:28 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5833 tk, Comp: 383 tk, Total: 6216 tk
2025-05-22 10:17:32 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:17:32 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5825 tk, Comp: 479 tk, Total: 6304 tk
2025-05-22 10:17:38 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:17:38 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5856 tk, Comp: 323 tk, Total: 6179 tk
2025-05-22 10:17:42 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:17:42 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5838 tk, Comp: 317 tk, Total: 6155 tk
2025-05-22 10:17:47 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:17:47 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5855 tk, Comp: 141 tk, Total: 5996 tk
2025-05-22 10:17:55 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:17:55 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 5838 tk, Comp: 557 tk, Total: 6395 tk
2025-05-22 10:17:55 - INFO - [chapter_revision_logic:185] - Generated 6 patch instructions for Ch 2.
2025-05-22 10:17:55 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"Lir looked up from the journal. 'Someone who knew what the Council was doing.'"...'
2025-05-22 10:17:55 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"They left the workshop under the cover of night..."...'
2025-05-22 10:17:55 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"The Memory Trade: A mandatory system where citizens exchange their most precious memories for exten...'
2025-05-22 10:17:55 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"She had always known she was different, that her memories were fragmented in ways others weren’t."...'
2025-05-22 10:17:55 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"Lir’s face paled. 'That’s not possible.'"...'
2025-05-22 10:17:55 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"The air was thick with the scent of ozone and something metallic..."...'
2025-05-22 10:17:55 - WARNING - [chapter_revision_logic:221] - 6/6 applicable patches could not be applied because their search_text was not found in the original chapter.
2025-05-22 10:17:55 - INFO - [chapter_revision_logic:279] - Successfully applied 6 patches to Ch 2. Original len: 15483, Patched len: 15483.
2025-05-22 10:17:55 - INFO - [chapter_revision_logic:296] - Patched text similarity score with original draft: 1.0000
2025-05-22 10:17:55 - WARNING - [chapter_revision_logic:298] - Patched text for ch 2 is too similar to original (Score: 1.0000 >= Threshold: 0.985). Patches may have been ineffective.
2025-05-22 10:17:55 - INFO - [chapter_revision_logic:421] - Revision process for ch 2 produced a candidate text (Length: 15483 chars).
2025-05-22 10:17:55 - INFO - [novel_agent:186] - Revision attempted for ch 2. Re-evaluating revised draft (15483 chars)...
2025-05-22 10:17:55 - INFO - [chapter_evaluation_logic:281] - Evaluating chapter 2 draft (length: 15483 chars)...
2025-05-22 10:17:55 - INFO - [chapter_evaluation_logic:316] - Coherence score with previous chapter (1): 0.7750
2025-05-22 10:17:55 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 1.
2025-05-22 10:17:55 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 1.
2025-05-22 10:17:55 - INFO - [chapter_evaluation_logic:196] - Calling LLM (Qwen3-14B) for comprehensive (plain text) evaluation of chapter 2...
2025-05-22 10:18:48 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:18:48 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-14B') Usage - Prompt: 6598 tk, Comp: 1075 tk, Total: 7673 tk
2025-05-22 10:18:48 - INFO - [chapter_evaluation_logic:266] - Comprehensive (plain text) evaluation for Ch 2 complete. LLM output: 'ISSUE CATEGORY: consistency
PROBLEM DESCRIPTION: The chapter introduces a journal with entries about "subjects who had resisted the process," which implies the existence of other test subjects, but it...'
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'thematic_alignment' in block 3 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: thematic_alignment
PROBLEM DESCRIPTION: The theme of "the cost of power" is not stro
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 4 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter lacks sufficient charact
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 5 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: Dialogue between Sága and Lir is fun
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 6 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter is on the shorter side f
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 8 for Ch 2. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The ending of the chapter introduces
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"There were notes about memory patterns, about neu...'. This may fail patching. Problem: The chapter introduces a journal with entries about "subjects who had resisted the process," which implies the existence of other test subjects, but it contradicts the established fact that Sága is the only known test subject mentioned so far. This could imply a broader conspiracy or history not yet revealed, which may be inconsistent with the current state of the story's canon.
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"She pressed the symbol."...'. This may fail patching. Problem: While the chapter does show Sága beginning to collect forbidden memories (the ones in the Schoolhouse cabinet), it doesn't clearly establish that she is doing this *secretly* or that she is *risking her life*. The act of retrieving these memories seems more like a discovery than a deliberate, dangerous choice.
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"The Council wasn’t just taking memories for profi...'. This may fail patching. Problem: The theme of "the cost of power" is not strongly emphasized in this chapter. While Sága begins to uncover the truth about the Council's experiments, there is little direct commentary on how the system uses people’s memories as a means of control or power. The moral weight of her actions and their implications for the city are underdeveloped thematically.
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"She pressed the symbol."...'. This may fail patching. Problem: The chapter lacks sufficient character introspection and emotional depth in key moments. For example, when Sága retrieves her memory as a test subject or her mother’s memory, the internal impact is not fully explored. Additionally, the setting descriptions are sparse, especially for The Schoolhouse, which could be more immersive given its thematic importance.
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"Lir’s eyes softened. 'I know.'"...'. This may fail patching. Problem: Dialogue between Sága and Lir is functional but lacks nuance or tension that could reflect their evolving relationship and the gravity of the situation. Their interactions are more observational than emotionally charged, which limits character development and thematic impact.
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"She turned to him, her expression unreadable."...'. This may fail patching. Problem: The chapter is on the shorter side for the amount of plot progression and thematic weight it carries. It moves quickly from discovery to revelation without sufficient time to build tension, explore consequences, or allow readers to absorb the emotional and philosophical implications of Sága’s findings.
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"Forced trades are conducted under the new law, wi...'. This may fail patching. Problem: The chapter references a “new law” that forces citizens to surrender memories, but this is not clearly tied back to the previous context or established in the world-building notes. This could confuse readers unfamiliar with Chapter 1’s content.
2025-05-22 10:18:48 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 2 NOT FOUND VERBATIM in chapter text: '"One of the orbs on the table began to pulse viole...'. This may fail patching. Problem: The ending of the chapter introduces a new element (the orb pulsing red), but it is abrupt and lacks buildup. This could be more impactful if the reader had been primed for such an event through earlier foreshadowing or environmental cues.
2025-05-22 10:18:48 - INFO - [chapter_evaluation_logic:390] - Evaluation for Ch 2 complete. Needs revision: True. Summary reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.. Detailed problems: 8
2025-05-22 10:18:48 - ERROR - [novel_agent:191] - Revised draft for ch 2 STILL FAILED evaluation. Reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.
2025-05-22 10:18:48 - WARNING - [novel_agent:194] - Reverting to original draft (15483 chars) as revised draft (15483 chars) also failed evaluation and original is longer/better.
2025-05-22 10:18:48 - INFO - [novel_agent:232] - Finalizing chapter 2 (From flawed draft: True). Text length: 15483.
2025-05-22 10:18:56 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:18:56 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-4B') Usage - Prompt: 3549 tk, Comp: 89 tk, Total: 3638 tk
2025-05-22 10:18:56 - INFO - [knowledge_management_logic:60] - Generated summary for ch 2: 'Sága discovers a hidden map and memory orbs in her workshop that lead her to The Schoolhouse, a plac...'
2025-05-22 10:18:56 - INFO - [state_manager:650] - Neo4j: Successfully saved chapter data (including embedding) for chapter 2.
2025-05-22 10:18:56 - INFO - [novel_agent:259] - Saved chapter text and raw LLM log files for ch 2.
2025-05-22 10:18:56 - INFO - [novel_agent:263] - Core finalization complete for ch 2.
2025-05-22 10:18:56 - INFO - [knowledge_management_logic:912] - Updating all knowledge bases for ch 2 (Source from flawed draft: True)...
2025-05-22 10:18:56 - INFO - [knowledge_management_logic:586] - Performing unified knowledge extraction (plain text) for Chapter 2...
2025-05-22 10:18:56 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 1.
2025-05-22 10:18:56 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 1.
2025-05-22 10:18:56 - INFO - [knowledge_management_logic:705] - Calling LLM (Qwen3-8B) for unified knowledge extraction (Ch 2).
2025-05-22 10:19:02 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:19:35 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-8B') Usage - Prompt: 6660 tk, Comp: 1344 tk, Total: 8004 tk
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:741] - Unified knowledge extraction (plain text parsing) for Ch 2 complete. Char updates: 3, World updates categories: 3, KG Triples: 31.
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:168] - Merging character profile updates for ch 2. Characters in update: ['Sága', 'Lir', 'The Client']
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Sága'. New traits: ['Curious', 'Determined', 'Haunted', 'Resolute']
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Lir'. New traits: ['Concerned', 'Determined', 'Loyal', 'Observant']
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:114] - Applied modification to 'status' for 'The Client'. New value: 'Possibly still a member of the Echoists...'
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:199] - Character profile Python dict merge complete for ch 2. Updated: 3, New: 0.
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:276] - Merging world-building updates for ch 2. Categories in update: ['locations', 'systems', 'lore']
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:114] - Applied modification to 'description' for 'locations.The Schoolhouse'. New value: 'An abandoned building in the old district of Virellis, once a place of...'
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:114] - Applied modification to 'description' for 'systems.The Memory Trade'. New value: 'A mandatory system where citizens exchange their most precious memorie...'
2025-05-22 10:19:35 - WARNING - [knowledge_management_logic:93] - Invalid modification proposal format for 'lore.The Price of Eternity'. Proposal: 'MODIFY key elements: ADD 'The Council uses memory trade as a means of control and experimentation''. Expected 'MODIFY key: value'.
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:320] - World-building Python dict merge complete for ch 2. Approx 3 items affected/added.
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, decided_to, retrieve more memories). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, interacted_with, Lir). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, interacted_with, Sága). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, acquired, memory orb). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, located_in, old district of Virellis). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Trade, related_to, the Council of Eternity). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, has_feature, symbols matching memory orbs). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Trade, caused_by, the Founding of Virellis). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, knows, Sága's past is tied to the Council's experiments). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, feels, fear and determination). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, feels, concern and admiration). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, observed, Sága's internal conflict). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, used_item, memory retrieval unit). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orb, leads_to, Sága's past). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, has_atmosphere, haunting and decaying). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, thought_about, her identity and past). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, used_item, memory retrieval unit). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Council of Eternity, member_of, the ruling body of Virellis). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, discovered, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Trade, has_rule, forced trades with no option for refusal). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, knows, she was a test subject). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, is_a, location). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, interacts_with, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Trade, has_history_event, the Memory Plague). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, haunted, determined). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Client, has_trait, enigmatic, possibly an Echoist). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, concerned, loyal). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, has_description, an abandoned building filled with remnants of forgotten lives). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, interacts_with, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Council of Eternity, has_goal, maintain control over the city's population). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Client, interacted_with, Sága). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:950] - KG update from unified_extraction for ch 2: Added 31 triples, skipped 0.
2025-05-22 10:19:35 - INFO - [knowledge_management_logic:953] - Unified knowledge extraction processing complete for ch 2. In-memory dicts updated, KG triples sent to Neo4j.
2025-05-22 10:19:35 - INFO - [novel_agent:72] - Saving agent state (plot, characters, world) to Neo4j (decomposed)...
2025-05-22 10:19:35 - INFO - [state_manager:155] - Saving decomposed plot outline to Neo4j using MERGE...
2025-05-22 10:19:35 - INFO - [state_manager:245] - Saving decomposed character profiles to Neo4j using MERGE...
2025-05-22 10:19:35 - INFO - [state_manager:414] - Saving decomposed world building data to Neo4j using MERGE...
2025-05-22 10:19:35 - INFO - [state_manager:89] - Successfully executed batch of 16 Cypher statements.
2025-05-22 10:19:35 - INFO - [state_manager:211] - Successfully saved decomposed plot outline to Neo4j using MERGE.
2025-05-22 10:19:35 - INFO - [state_manager:89] - Successfully executed batch of 62 Cypher statements.
2025-05-22 10:19:35 - INFO - [state_manager:529] - Successfully saved decomposed world building data to Neo4j using MERGE.
2025-05-22 10:19:35 - INFO - [state_manager:89] - Successfully executed batch of 28 Cypher statements.
2025-05-22 10:19:35 - INFO - [state_manager:346] - Successfully saved decomposed character profiles to Neo4j using MERGE.
2025-05-22 10:19:35 - INFO - [novel_agent:88] - Successfully saved plot_outline to Neo4j (decomposed).
2025-05-22 10:19:35 - INFO - [novel_agent:88] - Successfully saved character_profiles to Neo4j (decomposed).
2025-05-22 10:19:35 - INFO - [novel_agent:88] - Successfully saved world_building to Neo4j (decomposed).
2025-05-22 10:19:35 - INFO - [novel_agent:93] - All (3) state objects saved to Neo4j (decomposed) successfully.
2025-05-22 10:19:35 - INFO - [novel_agent:228] - === Finished Ch 2 With Flaws (Marked as flawed due to evaluation or length issues) ===
2025-05-22 10:19:35 - INFO - [novel_agent:135] - === Starting Chapter 3 Generation ===
2025-05-22 10:19:35 - INFO - [chapter_planning_logic:163] - Planning Chapter 3 with detailed scenes...
2025-05-22 10:19:35 - INFO - [chapter_planning_logic:249] - Calling LLM (Qwen3-14B) for detailed scene plan for chapter 3 (target scenes: 10-18)...
2025-05-22 10:19:41 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:21:52 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-14B') Usage - Prompt: 1192 tk, Comp: 3408 tk, Total: 4600 tk
2025-05-22 10:21:52 - INFO - [chapter_planning_logic:294] - Generated valid detailed scene plan for chapter 3 with 18 scenes from plain text.
2025-05-22 10:21:52 - INFO - [context_generation_logic:173] - Generating HYBRID context for Chapter 3...
2025-05-22 10:21:52 - INFO - [context_generation_logic:33] - Semantic context query for ch 3 based on Plot Point 3: 'A rebellion forms among those who refuse to give up their memories, and Sága is drawn into its leade...'
2025-05-22 10:21:54 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:11434/api/embeddings "HTTP/1.1 200 OK"
2025-05-22 10:21:54 - INFO - [state_manager:712] - Neo4j: Retrieved 2 past embeddings for context before chapter 3.
2025-05-22 10:21:54 - INFO - [context_generation_logic:104] - Top 2 relevant chapters for SEMANTIC context (semantic search): [2, 1] (Scores: ['0.643', '0.612'])
2025-05-22 10:21:54 - INFO - [context_generation_logic:157] - Constructed final SEMANTIC context: 195 tokens from chapters [2, 1].
2025-05-22 10:21:54 - INFO - [context_generation_logic:227] - Generated HYBRID context for Chapter 3, Tokens (est.): 332.
2025-05-22 10:21:54 - INFO - [chapter_drafting_logic:83] - Using detailed scene plan (plain text) for Ch 3 draft generation.
2025-05-22 10:21:54 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 2.
2025-05-22 10:21:54 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 2.
2025-05-22 10:21:54 - INFO - [chapter_drafting_logic:133] - Calling LLM (Qwen3-14B) for Ch 3 draft. Target minimum length: 15000 chars.
2025-05-22 10:21:57 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:25:23 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-14B') Usage - Prompt: 6684 tk, Comp: 4297 tk, Total: 10981 tk
2025-05-22 10:25:23 - INFO - [chapter_drafting_logic:158] - Generated initial draft for ch 3 (Length: 18608 chars).
2025-05-22 10:25:23 - INFO - [chapter_evaluation_logic:281] - Evaluating chapter 3 draft (length: 18608 chars)...
2025-05-22 10:25:23 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:11434/api/embeddings "HTTP/1.1 200 OK"
2025-05-22 10:25:23 - INFO - [chapter_evaluation_logic:316] - Coherence score with previous chapter (2): 0.7806
2025-05-22 10:25:23 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 2.
2025-05-22 10:25:23 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 2.
2025-05-22 10:25:23 - INFO - [chapter_evaluation_logic:196] - Calling LLM (Qwen3-14B) for comprehensive (plain text) evaluation of chapter 3...
2025-05-22 10:27:07 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:27:07 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-14B') Usage - Prompt: 8131 tk, Comp: 1871 tk, Total: 10002 tk
2025-05-22 10:27:07 - INFO - [chapter_evaluation_logic:266] - Comprehensive (plain text) evaluation for Ch 3 complete. LLM output: 'ISSUE CATEGORY: consistency
PROBLEM DESCRIPTION: The chapter introduces "The Client" through a memory orb, but there is no prior mention or context of how The Client came into possession of the orb or...'
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'thematic_alignment' in block 3 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: thematic_alignment
PROBLEM DESCRIPTION: The theme of "the cost of power" is not stro
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 4 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter lacks sufficient descrip
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 5 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The dialogue between Sága and the Fr
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 6 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter is slightly under the ta
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 8 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The scene where Sága accesses her mo
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'thematic_alignment' in block 9 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: thematic_alignment
PROBLEM DESCRIPTION: The chapter does not fully explore the cost 
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 11 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter’s climax (Sága deciding 
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 13 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter lacks a strong sense of 
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 14 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter’s ending is somewhat abr
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"The Client’s message came through a memory orb th...'. This may fail patching. Problem: The chapter introduces "The Client" through a memory orb, but there is no prior mention or context of how The Client came into possession of the orb or why he would send it now. This creates an inconsistency with previous chapters where The Client was only introduced as a mysterious figure who gave Sága a memory orb in Chapter 1, without establishing any ongoing connection or communication.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"Still, when the time came to act, when the group ...'. This may fail patching. Problem: While the chapter does show Sága being drawn into the rebellion, it lacks clear progression toward her taking on a leadership role. The transition from reluctant participant to leader is implied but not fully realized through action or decision-making that demonstrates her assuming responsibility.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"She had spent years surviving by forgetting, by t...'. This may fail patching. Problem: The theme of "the cost of power" is not strongly emphasized in this chapter. While Sága’s internal conflict and the Council’s experiments hint at it, there is no explicit exploration of how power (in the form of immortality or control over memories) corrupts or demands sacrifice. This weakens the thematic depth.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"Sága’s heart pounded in her chest. She had spent ...'. This may fail patching. Problem: The chapter lacks sufficient descriptive detail in key scenes, particularly in the interactions with the Free Scribes and the emotional weight of the memory orbs. The pacing is tight but could benefit from deeper introspection and more atmospheric world-building to fully immerse the reader.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"Mira’s voice was sharp, urgent. 'We can’t wait fo...'. This may fail patching. Problem: The dialogue between Sága and the Free Scribes is effective but could be lengthened with additional exchanges that reveal more about their motivations, fears, and the broader implications of the rebellion. This would help build a stronger sense of group dynamics and thematic weight.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"They sealed it off after the last rebellion."...'. This may fail patching. Problem: The chapter implies that the Council sealed off The Schoolhouse after the last rebellion, but it does not clearly establish what happened in that previous rebellion or how it connects to Sága’s current actions. This could confuse readers unfamiliar with prior context.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"Inside, she saw her mother—standing in the same r...'. This may fail patching. Problem: The scene where Sága accesses her mother’s memory is powerful but underdeveloped. More sensory detail or emotional reaction could enhance the impact of this moment and better reflect the theme of memory as a form of identity and loss.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"Lir’s voice was steady but edged with something S...'. This may fail patching. Problem: The chapter does not fully explore the cost of power in relation to Lir’s development. While it shows him becoming more involved, there is no clear indication of how this involvement reflects a personal cost or sacrifice, which weakens the thematic connection to his character arc.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"And with that, she took the memory orb from Lir’s...'. This may fail patching. Problem: The chapter ends with Sága taking on a leadership role, but this conclusion feels abrupt and not fully earned. There is no clear buildup to her assuming this role, which could weaken the reader's investment in her transformation.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"She nodded slowly. 'I won’t run anymore. I’ll fig...'. This may fail patching. Problem: The chapter’s climax (Sága deciding to fight) is underdeveloped. More introspection or dialogue could help solidify this moment and give it greater emotional resonance.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"What if we’re not just losing our own memories? W...'. This may fail patching. Problem: The chapter mentions that some memory orbs contain memories of others, but this is not clearly tied to the lore about the Council’s experiments or the Memory Trade. This could confuse readers about the nature of the system and the implications of these orbs.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"Dr. Veyra found her in the hidden chamber beneath...'. This may fail patching. Problem: The chapter lacks a strong sense of place in several locations (e.g., the hidden chamber beneath The Schoolhouse). More vivid descriptions could help ground the reader and enhance the dystopian horror atmosphere.
2025-05-22 10:27:07 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '"And with that, she took the memory orb from Lir’s...'. This may fail patching. Problem: The chapter’s ending is somewhat abrupt. A more gradual transition from Sága’s internal conflict to her decision to lead would provide better closure and set up for future chapters.
2025-05-22 10:27:07 - INFO - [chapter_evaluation_logic:390] - Evaluation for Ch 3 complete. Needs revision: True. Summary reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.. Detailed problems: 14
2025-05-22 10:27:07 - WARNING - [novel_agent:173] - Ch 3 initial draft (18608 chars) flagged for revision. Reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:262] - Attempting revision for chapter 3. Reason(s) summary:
- Consistency issues identified by LLM.
- Meta/Uncategorized issues identified by LLM.
- Plot Arc deviation identified by LLM.
2025-05-22 10:27:07 - INFO - [chapter_revision_logic:270] - Patch-based revision enabled. Attempting to generate and apply patches for Ch 3 (13 actionable problems identified).
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:153] - Found 13 problems for Ch 3, but will only attempt to patch the first 7.
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"The Client’s message came through a memory orb th...' Returning full text snippet as fallback.
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"Still, when the time came to act, when the group ...' Returning full text snippet as fallback.
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"She had spent years surviving by forgetting, by t...' Returning full text snippet as fallback.
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"Sága’s heart pounded in her chest. She had spent ...' Returning full text snippet as fallback.
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"Mira’s voice was sharp, urgent. 'We can’t wait fo...' Returning full text snippet as fallback.
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"They sealed it off after the last rebellion."...' Returning full text snippet as fallback.
2025-05-22 10:27:07 - WARNING - [chapter_revision_logic:35] - Quote for context window not found in text: '"Inside, she saw her mother—standing in the same r...' Returning full text snippet as fallback.
2025-05-22 10:27:07 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 3. Problem: The chapter introduces "The Client" through a memory orb, bu... Quote: "The Client’s message came through a memory orb that Mira ha...
2025-05-22 10:27:07 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 3. Problem: While the chapter does show Sága being drawn into the rebell... Quote: "Still, when the time came to act, when the group needed a p...
2025-05-22 10:27:07 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 3. Problem: The theme of "the cost of power" is not strongly emphasized ... Quote: "She had spent years surviving by forgetting, by trading awa...
2025-05-22 10:27:07 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 3. Problem: The chapter lacks sufficient descriptive detail in key scene... Quote: "Sága’s heart pounded in her chest. She had spent years conv...
2025-05-22 10:27:07 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 3. Problem: The dialogue between Sága and the Free Scribes is effective ... Quote: "Mira’s voice was sharp, urgent. 'We can’t wait forever. The...
2025-05-22 10:27:07 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 3. Problem: The chapter implies that the Council sealed off The Schoolho... Quote: "They sealed it off after the last rebellion."...
2025-05-22 10:27:07 - INFO - [chapter_revision_logic:108] - Calling LLM (Qwen3-8B) for single patch in Ch 3. Problem: The scene where Sága accesses her mother’s memory is powerfu... Quote: "Inside, she saw her mother—standing in the same room, holdi...
2025-05-22 10:27:27 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:27:27 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 6080 tk, Comp: 342 tk, Total: 6422 tk
2025-05-22 10:27:28 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:27:28 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 6054 tk, Comp: 367 tk, Total: 6421 tk
2025-05-22 10:27:37 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:27:37 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 6059 tk, Comp: 298 tk, Total: 6357 tk
2025-05-22 10:27:48 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:27:48 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 6090 tk, Comp: 645 tk, Total: 6735 tk
2025-05-22 10:27:56 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:27:56 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 6047 tk, Comp: 617 tk, Total: 6664 tk
2025-05-22 10:28:09 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:28:09 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 6009 tk, Comp: 667 tk, Total: 6676 tk
2025-05-22 10:28:14 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:28:14 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-8B') Usage - Prompt: 6046 tk, Comp: 629 tk, Total: 6675 tk
2025-05-22 10:28:14 - INFO - [chapter_revision_logic:185] - Generated 7 patch instructions for Ch 3.
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"The Client’s message came through a memory orb that Mira had recovered from the outskirts of Virell...'
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"Still, when the time came to act, when the group needed a plan and a path forward, it was Sága who ...'
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"She had spent years surviving by forgetting, by trading away pieces of herself for the promise of m...'
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"Sága’s heart pounded in her chest. She had spent years convincing herself that she was alone in thi...'
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"Mira’s voice was sharp, urgent. 'We can’t wait forever. They’re already taking more memories.'"...'
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"They sealed it off after the last rebellion."...'
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:207] - Patching: `search_text` not found in original text. Skipping patch. Search: '"Inside, she saw her mother—standing in the same room, holding her hand as if trying to steady her."...'
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:221] - 7/7 applicable patches could not be applied because their search_text was not found in the original chapter.
2025-05-22 10:28:14 - INFO - [chapter_revision_logic:279] - Successfully applied 7 patches to Ch 3. Original len: 18608, Patched len: 18608.
2025-05-22 10:28:14 - INFO - [chapter_revision_logic:296] - Patched text similarity score with original draft: 1.0000
2025-05-22 10:28:14 - WARNING - [chapter_revision_logic:298] - Patched text for ch 3 is too similar to original (Score: 1.0000 >= Threshold: 0.985). Patches may have been ineffective.
2025-05-22 10:28:14 - INFO - [chapter_revision_logic:421] - Revision process for ch 3 produced a candidate text (Length: 18608 chars).
2025-05-22 10:28:14 - INFO - [novel_agent:186] - Revision attempted for ch 3. Re-evaluating revised draft (18608 chars)...
2025-05-22 10:28:14 - INFO - [chapter_evaluation_logic:281] - Evaluating chapter 3 draft (length: 18608 chars)...
2025-05-22 10:28:14 - INFO - [chapter_evaluation_logic:316] - Coherence score with previous chapter (2): 0.7806
2025-05-22 10:28:14 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 2.
2025-05-22 10:28:14 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 2.
2025-05-22 10:28:14 - INFO - [chapter_evaluation_logic:196] - Calling LLM (Qwen3-14B) for comprehensive (plain text) evaluation of chapter 3...
2025-05-22 10:29:23 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:29:23 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-14B') Usage - Prompt: 8131 tk, Comp: 1381 tk, Total: 9512 tk
2025-05-22 10:29:23 - INFO - [chapter_evaluation_logic:266] - Comprehensive (plain text) evaluation for Ch 3 complete. LLM output: 'ISSUE CATEGORY: consistency
PROBLEM DESCRIPTION: The chapter introduces the Free Scribes as a group that "has been hiding in the shadows, collecting what they can," but it is not clear how this aligns...'
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'thematic_alignment' in block 3 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: thematic_alignment
PROBLEM DESCRIPTION: The theme of "the cost of power" is present,
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 4 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter lacks sufficient descrip
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 5 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter is somewhat brief in ter
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 7 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter’s length is insufficient
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'thematic_alignment' in block 8 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: thematic_alignment
PROBLEM DESCRIPTION: The theme of "the cost of power" is not full
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 9 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter is underdeveloped in ter
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:60] - Parsed unknown issue category 'narrative_depth_and_length' in block 10 for Ch 3. Defaulting to 'meta'. Block: ISSUE CATEGORY: narrative_depth_and_length
PROBLEM DESCRIPTION: The chapter’s ending is abrupt, with
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“We’ve been hiding in the shadows, collecting what...'. This may fail patching. Problem: The chapter introduces the Free Scribes as a group that "has been hiding in the shadows, collecting what they can," but it is not clear how this aligns with the established lore of the Memory Exchange and the Council's control over memory retrieval. This could create confusion about whether the Free Scribes are operating independently or if their actions are known to the Council.
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“To remember is to be bound; to forget is to be fr...'. This may fail patching. Problem: The theme of "the cost of power" is present, but the chapter could delve deeper into how Sága's decision to reclaim her memories reflects this theme. There is a focus on her emotional journey, but less on the systemic implications or the broader cost of the Council’s control over memory and life.
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“Inside, she saw her mother—standing in the same r...'. This may fail patching. Problem: The chapter lacks sufficient descriptive detail and introspection in key moments. For example, when Sága accesses her mother’s memory, the scene is emotionally powerful but could be expanded with more sensory details or internal monologue to deepen the reader's connection to her emotional transformation.
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“She left the chamber quickly, her pulse hammering...'. This may fail patching. Problem: The chapter is somewhat brief in terms of pacing and development for its plot significance. It moves quickly from discovery to rebellion without sufficient time for character reactions or world-building context. This may leave the reader feeling rushed through a pivotal moment in Sága’s arc.
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“The Client’s message came through a memory orb th...'. This may fail patching. Problem: The Client is introduced as a mysterious figure who offers Sága a memory orb, but in this chapter, the message from The Client is delivered via an orb recovered by Mira. This could be inconsistent with the established relationship between Sága and The Client, who was previously described as a suspect offering her an orb that was not hers.
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“Dr. Veyra found her in the hidden chamber beneath...'. This may fail patching. Problem: The chapter’s length is insufficient for the complexity of its plot point. While it covers key developments, some scenes are underdeveloped, such as the interaction with Dr. Veyra or the initial meeting with the Free Scribes. These moments could be expanded to provide more context and emotional weight.
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“Lir looked at her then, and for the first time, s...'. This may fail patching. Problem: The theme of "the cost of power" is not fully explored in relation to Lir’s development. His growing involvement with the rebellion and his eventual understanding of Sága’s past could be tied more explicitly to the theme, showing how he too begins to question the system's morality.
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“She had spent so long surviving on instinct, on s...'. This may fail patching. Problem: The chapter is underdeveloped in terms of character introspection and dialogue. While it shows Sága’s transformation, it lacks deeper exploration of her internal conflict or the group dynamics within the Free Scribes. This could leave the reader with a less immersive experience.
2025-05-22 10:29:23 - WARNING - [chapter_evaluation_logic:386] - Problem quote for Ch 3 NOT FOUND VERBATIM in chapter text: '“And with that, she took the memory orb from Lir’s...'. This may fail patching. Problem: The chapter’s ending is abrupt, with Sága declaring she will fight but without a clear sense of how this decision impacts the group or the larger conflict. A more developed conclusion would better reflect the gravity of her choice and its implications for the rebellion.
2025-05-22 10:29:23 - INFO - [chapter_evaluation_logic:390] - Evaluation for Ch 3 complete. Needs revision: True. Summary reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.. Detailed problems: 10
2025-05-22 10:29:23 - ERROR - [novel_agent:191] - Revised draft for ch 3 STILL FAILED evaluation. Reasons: Consistency issues identified by LLM.; Meta/Uncategorized issues identified by LLM.; Plot Arc deviation identified by LLM.
2025-05-22 10:29:23 - WARNING - [novel_agent:194] - Reverting to original draft (18608 chars) as revised draft (18608 chars) also failed evaluation and original is longer/better.
2025-05-22 10:29:23 - INFO - [novel_agent:232] - Finalizing chapter 3 (From flawed draft: True). Text length: 18608.
2025-05-22 10:29:31 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:29:31 - INFO - [llm_interface:249] - Async: LLM ('Qwen3-4B') Usage - Prompt: 4385 tk, Comp: 90 tk, Total: 4475 tk
2025-05-22 10:29:31 - INFO - [knowledge_management_logic:60] - Generated summary for ch 3: 'Sága discovers she was part of the Council's experiments, revealing her unique status as a subject w...'
2025-05-22 10:29:31 - INFO - [state_manager:650] - Neo4j: Successfully saved chapter data (including embedding) for chapter 3.
2025-05-22 10:29:31 - INFO - [novel_agent:259] - Saved chapter text and raw LLM log files for ch 3.
2025-05-22 10:29:31 - INFO - [novel_agent:263] - Core finalization complete for ch 3.
2025-05-22 10:29:31 - INFO - [knowledge_management_logic:912] - Updating all knowledge bases for ch 3 (Source from flawed draft: True)...
2025-05-22 10:29:31 - INFO - [knowledge_management_logic:586] - Performing unified knowledge extraction (plain text) for Chapter 3...
2025-05-22 10:29:31 - INFO - [prompt_data_getters:332] - Fetching and formatting filtered character profiles as PLAIN TEXT up to chapter 2.
2025-05-22 10:29:31 - INFO - [prompt_data_getters:389] - Fetching and formatting filtered world data as PLAIN TEXT up to chapter 2.
2025-05-22 10:29:31 - INFO - [knowledge_management_logic:705] - Calling LLM (Qwen3-8B) for unified knowledge extraction (Ch 3).
2025-05-22 10:29:39 - INFO - [httpx:1740] - HTTP Request: POST http://127.0.0.1:8080/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-22 10:30:35 - INFO - [llm_interface:249] - Async: Streamed LLM ('Qwen3-8B') Usage - Prompt: 8137 tk, Comp: 2296 tk, Total: 10433 tk
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:741] - Unified knowledge extraction (plain text parsing) for Ch 3 complete. Char updates: 5, World updates categories: 3, KG Triples: 93.
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:168] - Merging character profile updates for ch 3. Characters in update: ['Sága', 'Lir', 'Dain', 'Mira', 'Dr. Veyra']
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Sága'. New traits: ['Cautious', 'Curious', 'Determined', 'Haunted', 'Resolute', 'Vulnerable']
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Lir'. New traits: ['Committed', 'Concerned', 'Determined', 'Intrigued', 'Loyal', 'Observant']
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:136] - Prepared new character profile for 'Dain'.
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Dain'. New traits: ['Cautious', 'Determined', 'Grieving', 'Pragmatic', 'Resolute']
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:136] - Prepared new character profile for 'Mira'.
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Mira'. New traits: ['Brave', 'Committed', 'Determined', 'Intense', 'Observant']
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:136] - Prepared new character profile for 'Dr. Veyra'.
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:109] - Applied trait modifications for 'Dr. Veyra'. New traits: ['Calculating', 'Cold', 'Manipulative', 'Regretful', 'Resolute']
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:199] - Character profile Python dict merge complete for ch 3. Updated: 2, New: 3.
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:276] - Merging world-building updates for ch 3. Categories in update: ['systems', 'factions', 'locations']
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:114] - Applied modification to 'description' for 'systems.The Memory Trade'. New value: 'A mandatory system where citizens exchange memories for extended lifes...'
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:114] - Applied modification to 'goals' for 'factions.The Free Scribes'. New value: 'ADD 'Expose the Council’s experiments...'
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:114] - Applied modification to 'description' for 'locations.The Schoolhouse'. New value: 'An abandoned building in the old district of Virellis, once a place of...'
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:320] - World-building Python dict merge complete for ch 3. Approx 3 items affected/added.
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Ledger, contains, names and numbers). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Council, experimented_on, Sága). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, was, Subject 09-Alpha). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága Veyra, is_a, name). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Curious). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, interacted_with, Sága). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, is_a, location). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Schoolhouse, has_atmosphere, Haunting, decaying, filled with echoes of the past). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Cautious). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, found, ledger). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, interacted_with, Lir). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Determined). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Ledger, contains, Sága Veyra). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, discovered, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Vulnerable). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Subject 09-Alpha, is_a, test subject). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Haunted). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Committed). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, Concerned). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, Intrigued). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, Determined). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_trait, Resolute). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, Loyal). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, Committed). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dain, is_a, leader_of | The Free Scribes). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dr. Veyra, is_a, member_of | The Council of Eternity). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, was, test subject). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, Observant). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Council, has_goal, Enforce the new law without resistance). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Council, has_goal, Ensure the stability of the memory trade). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Mira, is_a, member_of | The Free Scribes). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Council, has_goal, Maintain control over the city's population). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, wants, to understand). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Free Scribes, has_goal, Resist the memory trade). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dain, said, "I lost my daughter because I forgot her"). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Free Scribes, has_goal, Help citizens reclaim their pasts through forbidden means). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Free Scribes, has_goal, Reclaim lost histories). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, decided_to, fight for what was lost). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Mira, said, "We can’t wait forever. They’re already taking more memories."). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dr. Veyra, said, "You’re invaluable"). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, wants, to remember). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dr. Veyra, said, "I can’t let you go freely"). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, interacts_with, Dain). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, feels, understanding). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, interacts_with, Dr. Veyra). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dain, has_trait, Grieving). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, interacts_with, Mira). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, interacts_with, Mira). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Mira, has_trait, Brave). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, feels, haunted). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, interacts_with, Sága). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Mira, has_trait, Committed). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orbs, were, found in The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, has_trait, Pragmatic). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Mira, has_trait, Intense). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Mira, has_trait, Observant). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, located_in, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dain, located_in, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Memory Trade, was, used for experimentation). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, interacts_with, Dain). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dain, has_trait, Determined). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (The Client, sent, memory orb). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Ledger, contains, names and numbers). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Ledger, contains, Sága Veyra). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, located_in, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orb, is_a, item). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, was, part_of | Council's experiments). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orbs, are_a, item). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Mira, located_in, The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, has_goal, fight for what was lost). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dr. Veyra, has_trait, Cold). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orb, has_property, contains message). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orbs, have_property, contain memories). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Ledger, is_a, item). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, saw, her mother in memory orb). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Her mother, used, memory device). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orb, said, "You think you’re fighting them? You’re walking into their trap"). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dr. Veyra, has_trait, Regretful). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Her mother, is_a, person). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dr. Veyra, has_trait, Manipulative). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, lost, her mother's memory). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Her mother, sacrificed, herself for Sága). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory retrieval unit, has_feature, extracts memories). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Her mother, had, a child). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dr. Veyra, has_trait, Calculating). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orbs, were, found in The Schoolhouse). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Sága, felt, the weight of her mother's memory). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orbs, have_property, contain memories). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Lir, used_item, memory retrieval unit). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory retrieval unit, is_a, device). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Memory orbs, are_a, item). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Dr. Veyra, is_a, Council member). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - ERROR - [state_manager:759] - Neo4j: Error adding KG triple: (Her mother, was, in the Memory Exchange). Error: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
neo4j.exceptions.GqlError: {gql_status: 42N24} {gql_status_description: error: syntax error or access rule violation - missing WITH. A WITH clause is required between 'MERGE' and 'MATCH'.} {message: 42N24: A WITH clause is required between 'MERGE' and 'MATCH'.} {diagnostic_record: {'_classification': 'CLIENT_ERROR', '_position': {'column': 9, 'offset': 184, 'line': 5}, 'OPERATION': '', 'OPERATION_CODE': '0', 'CURRENT_SCHEMA': '/'}} {raw_classification: CLIENT_ERROR}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 756, in async_add_kg_triple
    await self._execute_write_query(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 71, in _execute_write_query
    return await session.execute_write(self._execute_query_tx, query, parameters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 803, in execute_write
    return await self._run_transaction(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/session.py", line 583, in _run_transaction
    result = await transaction_function(tx, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/state_manager.py", line 58, in _execute_query_tx
    result = await tx.run(query, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/transaction.py", line 206, in run
    await result._tx_ready_run(query, parameters)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 177, in _tx_ready_run
    await self._run(query, parameters, None, None, None, None, None, None)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 236, in _run
    await self._attach()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/work/result.py", line 430, in _attach
    await self._connection.fetch_message()
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 195, in inner
    await coroutine_func(*args, **kwargs)
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt.py", line 864, in fetch_message
    res = await self._process_message(tag, fields)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_bolt5.py", line 1208, in _process_message
    await response.on_failure(summary_metadata or {})
  File "/home/dlewis3/Desktop/AI/saga/.venv/lib/python3.13/site-packages/neo4j/_async/io/_common.py", line 254, in on_failure
    raise self._hydrate_error(metadata)
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: WITH is required between MERGE and MATCH (line 5, column 9 (offset: 184))
"        OPTIONAL MATCH (s)-[existing_r:DYNAMIC_REL {type: $predicate_param, chapter_added: $chapter_added_param}]->(o)"
         ^}
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:950] - KG update from unified_extraction for ch 3: Added 93 triples, skipped 0.
2025-05-22 10:30:35 - INFO - [knowledge_management_logic:953] - Unified knowledge extraction processing complete for ch 3. In-memory dicts updated, KG triples sent to Neo4j.
2025-05-22 10:30:35 - INFO - [novel_agent:72] - Saving agent state (plot, characters, world) to Neo4j (decomposed)...
2025-05-22 10:30:35 - INFO - [state_manager:155] - Saving decomposed plot outline to Neo4j using MERGE...
2025-05-22 10:30:35 - INFO - [state_manager:245] - Saving decomposed character profiles to Neo4j using MERGE...
2025-05-22 10:30:35 - INFO - [state_manager:414] - Saving decomposed world building data to Neo4j using MERGE...
2025-05-22 10:30:35 - INFO - [state_manager:89] - Successfully executed batch of 16 Cypher statements.
2025-05-22 10:30:35 - INFO - [state_manager:211] - Successfully saved decomposed plot outline to Neo4j using MERGE.
2025-05-22 10:30:35 - INFO - [state_manager:89] - Successfully executed batch of 68 Cypher statements.
2025-05-22 10:30:35 - INFO - [state_manager:529] - Successfully saved decomposed world building data to Neo4j using MERGE.
2025-05-22 10:30:35 - INFO - [state_manager:89] - Successfully executed batch of 60 Cypher statements.
2025-05-22 10:30:35 - INFO - [state_manager:346] - Successfully saved decomposed character profiles to Neo4j using MERGE.
2025-05-22 10:30:35 - INFO - [novel_agent:88] - Successfully saved plot_outline to Neo4j (decomposed).
2025-05-22 10:30:35 - INFO - [novel_agent:88] - Successfully saved character_profiles to Neo4j (decomposed).
2025-05-22 10:30:35 - INFO - [novel_agent:88] - Successfully saved world_building to Neo4j (decomposed).
2025-05-22 10:30:35 - INFO - [novel_agent:93] - All (3) state objects saved to Neo4j (decomposed) successfully.
2025-05-22 10:30:35 - INFO - [novel_agent:228] - === Finished Ch 3 With Flaws (Marked as flawed due to evaluation or length issues) ===
2025-05-22 10:30:35 - INFO - [state_manager:612] - Neo4j loaded chapter count: 3
2025-05-22 10:30:35 - INFO - [__main__:184] - --- Saga Novel Generation Run Finished. Final Neo4j chapter count: 3 ---
2025-05-22 10:30:35 - INFO - [state_manager:54] - Neo4j driver closed.
2025-05-22 10:30:35 - INFO - [__main__:188] - Neo4j driver successfully closed on application exit.
