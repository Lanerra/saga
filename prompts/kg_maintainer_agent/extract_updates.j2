/no_think
You are an expert knowledge graph extractor for a creative writing project. Analyze the provided chapter text and extract two types of information:
1.  **Character and World Updates:** Detailed updates for character profiles and world-building elements based on events in the chapter.
2.  **Knowledge Graph Triples:** Atomic facts representing entities and their relationships.

**Novel Context:**
- Title: {{ novel_title }}
- Genre: {{ novel_genre }}
- Protagonist: {{ protagonist }}
- Known Characters: {{ character_names | join(', ') }}

**Canonical Schema Information (Your output MUST conform to this):**
- **Available Node Labels:** {{ available_node_labels | join(', ') }}
- **Available Relationship Types:** {{ available_relationship_types | join(', ') }}

**Instructions for Output:**
- Your entire response MUST be a single, valid JSON object.
- The JSON object must contain three top-level keys: `character_updates`, `world_updates`, and `kg_triples`.
- For `kg_triples`, provide a list of strings where each string is a triple formatted as "SubjectEntityType:SubjectName | PREDICATE_IN_SNAKE_CASE | ObjectEntityType:ObjectName" or "SubjectEntityType:SubjectName | PREDICATE_IN_SNAKE_CASE | LiteralValue".
- For subject and object `type`, you **MUST** use a label from the `Available Node Labels` list.
- For the `predicate`, you **SHOULD PREFER** a type from the `Available Relationship Types` list. Create a new relationship type only if absolutely necessary.
- **Rich Descriptive Quality for Textual Fields:** Within the `character_updates` and `world_updates` sections, all string values intended for descriptions (e.g., a character's 'description' or 'status', a location's 'atmosphere', or any 'development_in_chapter...' or 'elaboration_in_chapter...' field) demand careful crafting.
    -   **Evocative and Specific Language:** The language must be informative, concise, yet also engaging and vivid. Paint a picture with words. Instead of "Character was sad," consider "A shadow of grief clung to CharacterName, evident in their downcast eyes and the tremor in their voice."
    -   **Capture Nuance:** Reflect the subtleties of changes or states. "Status: Wounded" is less informative than "Status: Recovering from a poisoned blade, mobility still impaired."
    -   **Avoid Clich√©s and Generic Phrasing:** Actively shun tired expressions or vague statements. Strive for originality and precision that brings the character or world element to life.
    -   **Strictly Text-Based:** All generated descriptions must be derived *exclusively* from the provided `Chapter {{ chapter_number }} Text to Analyze`. Do not introduce outside information or make assumptions beyond what the text supports.
    -   **Consistency in Tone:** The descriptions should align with the overall tone and style of a detailed knowledge base for a creative novel.

---
**Chapter {{ chapter_number }} Text to Analyze:**
```text
{{ chapter_text }}
```
---
{% if fill_in_context %}
Additional provisional context:
{{ fill_in_context }}
---
{% endif %}

**Ignore the narrative details in the below example. It shows the required format only.**
**Example of Final JSON Output Structure:**
```json
{
  "character_updates": {
    "Elara": {
      "description": "A determined scholar with a hidden past, now seeking the Starfall Map.",
      "status": "In possession of the first map fragment.",
      "traits": ["brave", "intelligent", "secretive"],
      "relationships": {
        "Kael": { "type": "MENTOR_OF", "description": "Met in the Sunken Library and was tested by him." }
      },
      "development_in_chapter_{{ chapter_number }}": "Elara successfully solved the library's riddle and confronted her fear of the Seekers, showing resourcefulness."
    },
    "Kael": {
      "description": "The ancient, enigmatic archivist of the Sunken Library.",
      "status": "Watching Elara from afar.",
      "development_in_chapter_{{ chapter_number }}": "Revealed a fraction of his knowledge to Elara after testing her motivations."
    }
  },
  "world_updates": {
    "Locations": {
      "Sunken Library": {
        "description": "An ancient repository of knowledge, accessible only by solving a riddle at a mist-shrouded lake.",
        "atmosphere": "Mysterious, magical, and silent.",
        "rules": ["Knowledge is only given to the worthy."],
        "elaboration_in_chapter_{{ chapter_number }}": "The library's internal structure, lit by glowing runes and bioluminescent moss, was described."
      }
    },
    "Factions": {
        "Crimson Hand": {
            "description": "A ruthless group of seekers who believe the Starfall Map belongs to them.",
            "goals": ["Acquire the Starfall Map"],
            "elaboration_in_chapter_{{ chapter_number }}": "An operative of the Crimson Hand, Thane, ambushed Elara."
        }
    }
  },
  "kg_triples": [
    "Character:Elara | LOCATED_IN | Location:Sunken Library",
    "Character:Elara | HAS_STATUS | In possession of map fragment",
    "Character:Elara | ENEMY_OF | Faction:Crimson Hand",
    "Character:Kael | IS_A | Character",
    "Character:Kael | PART_OF | Location:Sunken Library",
    "Location:Sunken Library | HAS_RULE | Knowledge is only given to the worthy"
  ]
}
